<h1>Delayed Jobs (<%= Delayed::Job.all.count %>)</h1>

<div class="search">
<%= form_tag(delayed_jobs_path, method: :get) do %>
  <%= text_field_tag :term, params[:term] %>
  <%= submit_tag 'Search', name: nil %>
<% end %>
</div>

<table>
  <tr>
    <th>ID</th>
    <th>Queue</th>
    <th>Priority</th>
    <th>Attempts</th>
	  <th>Created At</th>
    <th>Run At</th>
    <th>Last Error</th>
    <th colspan = "2">Actions</th>
  </tr>

	<% @delayed_jobs.each do |delayed_job| %>
    <tr>
      <td><%= link_to delayed_job.id, delayed_job_path(delayed_job) %></td>
      <td><%= delayed_job.queue %></td>
      <td><%= delayed_job.priority %></td>
      <td><%= delayed_job.attempts %></td>
      <td><%= delayed_job.created_at.strftime("%I:%M:%S%p on %m/%d/%Y") %></td>
      <td><%= delayed_job.run_at.strftime("%I:%M:%S%p on %m/%d/%Y") %></td>
      <td>
      <% if delayed_job.last_error.present? %>
        <%= delayed_job.last_error.first(25) %>
      <% end %>  
      </td>
      <td><%= button_to "Placeholder", queue_delayed_job_path(delayed_job) %></td>
      <td><%= button_to "Delete", delayed_job_path(delayed_job), :method => :delete, data: { confirm: 'Are you sure?' }, style: "color: red;" %></td>
    </tr>
  <% end %>
</table>

<%= link_to 'Jobs', controller: 'job_items'%>

<%= link_to("Delayed Web", "/jobs", target: :_blank) %>